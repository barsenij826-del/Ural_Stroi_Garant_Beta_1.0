// 1. БАЗА ДАННЫХ (32 объекта)
    const portfolioData = [
        { title: "ЖК «Кандинский»", desc: "Премиальный пентхаус в стиле минимализм" },
        { title: "ЖК «Макаровский»", desc: "Апартаменты с видом на набережную" },
        { title: "Вилла в Карасьеозерском", desc: "Загородная резиденция 450 м²" },
        { title: "БЦ «Высоцкий»", desc: "Офис представительского класса" },
        { title: "ЖК «Форум Сити»", desc: "Лофт-пространство для жизни" },
        { title: "Название объекта 6", desc: "Здесь будет описание" },
        { title: "Название объекта 7", desc: "Здесь будет описание" },
        { title: "Название объекта 8", desc: "Здесь будет описание" },
        { title: "Название объекта 9", desc: "Здесь будет описание" },
        { title: "Название объекта 10", desc: "Здесь будет описание" },
        { title: "Название объекта 11", desc: "Здесь будет описание" },
        { title: "Название объекта 12", desc: "Здесь будет описание" },
        { title: "Название объекта 13", desc: "Здесь будет описание" },
        { title: "Название объекта 14", desc: "Здесь будет описание" },
        { title: "Название объекта 15", desc: "Здесь будет описание" },
        { title: "Название объекта 16", desc: "Здесь будет описание" },
        { title: "Название объекта 17", desc: "Здесь будет описание" },
        { title: "Название объекта 18", desc: "Здесь будет описание" },
        { title: "Название объекта 19", desc: "Здесь будет описание" },
        { title: "Название объекта 20", desc: "Здесь будет описание" },
        { title: "Название объекта 21", desc: "Здесь будет описание" },
        { title: "Название объекта 22", desc: "Здесь будет описание" },
        { title: "Название объекта 23", desc: "Здесь будет описание" },
        { title: "Название объекта 24", desc: "Здесь будет описание" },
        { title: "Название объекта 25", desc: "Здесь будет описание" },
        { title: "Название объекта 26", desc: "Здесь будет описание" },
        { title: "Название объекта 27", desc: "Здесь будет описание" },
        { title: "Название объекта 28", desc: "Здесь будет описание" },
        { title: "Название объекта 29", desc: "Здесь будет описание" },
        { title: "Название объекта 30", desc: "Здесь будет описание" },
        { title: "Название объекта 31", desc: "Здесь будет описание" },
        { title: "Название объекта 32", desc: "Здесь будет описание" }
    ];

    const portfolioGrid = document.getElementById('portfolioGrid');
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    let visibleCount = 4;

    function initPortfolio() {
        let html = '';
        portfolioData.forEach((project, index) => {
            const id = index + 1;
            const isHidden = id > visibleCount ? 'hidden' : '';
            html += `
                <div class="project-frame ${isHidden}" id="project-${id}" onclick="openGallery(${index})">
                    <div class="project-card">
                        <div class="hover-btn">Посмотреть проект</div>
                        <img src="img/work_${id}.webp" alt="${project.title}" loading="lazy" onerror="handleImgError(${id})">
                        <div class="project-info-overlay">
                            <h3>${project.title}</h3>
                            <p>${project.desc}</p>
                        </div>
                    </div>
                </div>`;
        });
        portfolioGrid.innerHTML = html;
        checkLoadMoreButton(); // Проверяем кнопку сразу после создания
    }

    function handleImgError(id) {
        const card = document.getElementById('project-' + id);
        if (card) {
            card.remove(); // Удаляем карточку, если картинки нет
        }
        checkLoadMoreButton(); // Перепроверяем кнопку
    }

    function loadMore() {
        const hiddenCards = Array.from(document.querySelectorAll('.project-frame.hidden'));
        const nextBatch = hiddenCards.slice(0, 4);
        nextBatch.forEach(card => card.classList.remove('hidden'));
        checkLoadMoreButton();
    }

    function checkLoadMoreButton() {
        const remainingHidden = document.querySelectorAll('.project-frame.hidden').length;
        if (remainingHidden === 0) {
            loadMoreBtn.style.display = 'none';
        } else {
            loadMoreBtn.style.display = 'inline-block';
        }
    }

    // Остальные функции (openGallery, closeGallery, модалки и т.д.) оставляй как были
    function openGallery(index) {
        const project = portfolioData[index];
        const id = index + 1;
        const modal = document.getElementById('galleryOverlay');
        const grid = document.getElementById('galleryGrid');
        document.getElementById('modalTitle').innerText = project.title;
        document.getElementById('modalDesc').innerText = project.desc;
        grid.innerHTML = '';
        for (let j = 1; j <= 10; j++) {
            grid.innerHTML += `<div class="gallery-img-wrap"><img src="img/p${id}_${j}.webp" onerror="this.parentElement.remove()"></div>`;
        }
        modal.style.display = 'block';
        setTimeout(() => modal.classList.add('active'), 10);
        document.body.classList.add('no-scroll');
    }

    function closeGallery() {
        const modal = document.getElementById('galleryOverlay');
        if (modal) {
            modal.classList.remove('active');
            setTimeout(() => { modal.style.display = 'none'; document.body.classList.remove('no-scroll'); }, 400);
        }
    }

    function toggleFabMenu(e) {
        if (e) { e.preventDefault(); e.stopPropagation(); }
        const menu = document.getElementById('fabMenu');
        if (menu) menu.classList.toggle('active');
    }

    function openPhoneModal() {
        const modal = document.getElementById('phoneModal');
        if (modal) {
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
            document.body.classList.add('no-scroll');
        }
    }

    function closePhoneModal() {
        const modal = document.getElementById('phoneModal');
        if (modal) {
            modal.classList.remove('active');
            setTimeout(() => { modal.style.display = 'none'; document.body.classList.remove('no-scroll'); }, 400);
        }
    }

    window.addEventListener('click', (e) => {
        if (e.target.id === 'galleryOverlay') closeGallery();
        if (e.target.id === 'phoneModal') closePhoneModal();
        const fabMenu = document.getElementById('fabMenu');
        if (fabMenu && !fabMenu.contains(e.target)) fabMenu.classList.remove('active');
    });

    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    if (menuBtn) {
        menuBtn.onclick = function() {
            this.classList.toggle('active');
            mobileMenu.classList.toggle('active');
            document.body.classList.toggle('no-scroll');
        };
    }

    initPortfolio();
</script>
